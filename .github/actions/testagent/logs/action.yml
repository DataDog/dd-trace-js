name: "Get APM Test Agent Logs"
description: "Get the APM Test Agent logs from the test run."
inputs:
  container-id:
    description: "ID of the Docker Container to get logs from (optional)"
    required: false
runs:
  using: composite
  steps:
    - uses: actions/checkout@v2
    - run: |
        if [ -n "${{inputs.container-id}}" ]; then
          docker logs ${{inputs.container-id}}
        else
          docker-compose logs testagent
        fi
      shell: bash
    - uses: actions/checkout@v2
    - run: |
        RESPONSE=$(curl -s -w "\n%{http_code}" -o response.txt http://testagent:9126/test/trace_check/failures)
        RESPONSE_CODE=$(echo "$RESPONSE" | awk 'END {print $NF}')
        if [[ $RESPONSE_CODE -eq 200 ]]; then
          echo "All APM Test Agent Check Traces returned successful! (HTTP 200)"
        else
          echo "APM Test Agent Check Traces failed with response code: $RESPONSE_CODE"
          echo "Failures:"
          cat response.txt
          exit 1
        fi
      shell: bash
