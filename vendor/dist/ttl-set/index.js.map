{"version":3,"file":"ttl-set/index.js","sources":["webpack:///./fast-fifo/fixed-size.js","webpack:///./fast-fifo/index.js","webpack:///./ttl-set/index.js"],"sourcesContent":["module.exports = class FixedFIFO {\n  constructor (hwm) {\n    if (!(hwm > 0) || ((hwm - 1) & hwm) !== 0) throw new Error('Max size for a FixedFIFO should be a power of two')\n    this.buffer = new Array(hwm)\n    this.mask = hwm - 1\n    this.top = 0\n    this.btm = 0\n    this.next = null\n  }\n\n  clear () {\n    this.top = this.btm = 0\n    this.next = null\n    this.buffer.fill(undefined)\n  }\n\n  push (data) {\n    if (this.buffer[this.top] !== undefined) return false\n    this.buffer[this.top] = data\n    this.top = (this.top + 1) & this.mask\n    return true\n  }\n\n  shift () {\n    const last = this.buffer[this.btm]\n    if (last === undefined) return undefined\n    this.buffer[this.btm] = undefined\n    this.btm = (this.btm + 1) & this.mask\n    return last\n  }\n\n  peek () {\n    return this.buffer[this.btm]\n  }\n\n  isEmpty () {\n    return this.buffer[this.btm] === undefined\n  }\n}\n","const FixedFIFO = require('./fixed-size')\n\nmodule.exports = class FastFIFO {\n  constructor (hwm) {\n    this.hwm = hwm || 16\n    this.head = new FixedFIFO(this.hwm)\n    this.tail = this.head\n    this.length = 0\n  }\n\n  clear () {\n    this.head = this.tail\n    this.head.clear()\n    this.length = 0\n  }\n\n  push (val) {\n    this.length++\n    if (!this.head.push(val)) {\n      const prev = this.head\n      this.head = prev.next = new FixedFIFO(2 * this.head.buffer.length)\n      this.head.push(val)\n    }\n  }\n\n  shift () {\n    if (this.length !== 0) this.length--\n    const val = this.tail.shift()\n    if (val === undefined && this.tail.next) {\n      const next = this.tail.next\n      this.tail.next = null\n      this.tail = next\n      return this.tail.shift()\n    }\n\n    return val\n  }\n\n  peek () {\n    const val = this.tail.peek()\n    if (val === undefined && this.tail.next) return this.tail.next.peek()\n    return val\n  }\n\n  isEmpty () {\n    return this.length === 0\n  }\n}\n","'use strict'\n\nconst FIFO = require('fast-fifo')\n\nmodule.exports = class TTLSet {\n  constructor (ttl) {\n    this._ttl = ttl\n    this._list = new FIFO()\n    this._index = new Set()\n    this._timer = null\n  }\n\n  add (value) {\n    this._index.add(value)\n    this._list.push([Date.now(), value])\n    if (this._timer === null) {\n      this._timer = setTimeout(this._prune.bind(this), this._ttl).unref()\n    }\n  }\n\n  clear () {\n    this._list.clear()\n    this._index.clear()\n    clearTimeout(this._timer)\n    this._timer = null\n  }\n\n  has (value) {\n    return this._index.has(value)\n  }\n\n  get size () {\n    return this._index.size\n  }\n\n  _prune () {\n    while (true) {\n      const val = this._list.peek()\n      if (val === undefined) {\n        this._timer = null\n        return\n      }\n      if (val[0] > Date.now() - this._ttl) break\n      const evicted = this._list.shift()\n      this._index.delete(evicted[1])\n    }\n    this._timer = setTimeout(this._prune.bind(this), Date.now() - this._list.peek()[0]).unref()\n  }\n}\n"],"names":["Error","Array","t","Set","Date","setTimeout","clearTimeout"],"mappings":"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"}