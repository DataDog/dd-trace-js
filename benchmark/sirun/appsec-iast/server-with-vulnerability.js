'use strict'

const childProcess = require('child_process')
const express = require('../../../versions/express').get()
const cookieParser = require('../../../versions/cookie-parser').get()
const { port, reqs } = require('./common')

const app = express()
app.use(cookieParser())

let connectionsMade = 0

function noop () {}

app.get('/', (req, res) => {
  childProcess.exec('echo #' + req.query.param, noop)
  res.writeHead(200)
  res.end('Hello, World!')

  if (++connectionsMade === reqs) {
    server.close()
  }
})

const server = app.listen(port)
