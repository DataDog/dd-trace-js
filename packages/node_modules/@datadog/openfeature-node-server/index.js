(()=>{var e={"./spark-md5/spark-md5.js":function(e){e.exports=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],a=e[2],i=e[3];r+=(n&a|~n&i)+t[0]-0x28955b88|0,i+=((r=(r<<7|r>>>25)+n|0)&n|~r&a)+t[1]-0x173848aa|0,a+=((i=(i<<12|i>>>20)+r|0)&r|~i&n)+t[2]+0x242070db|0,n+=((a=(a<<17|a>>>15)+i|0)&i|~a&r)+t[3]-0x3e423112|0,r+=((n=(n<<22|n>>>10)+a|0)&a|~n&i)+t[4]-0xa83f051|0,i+=((r=(r<<7|r>>>25)+n|0)&n|~r&a)+t[5]+0x4787c62a|0,a+=((i=(i<<12|i>>>20)+r|0)&r|~i&n)+t[6]-0x57cfb9ed|0,n+=((a=(a<<17|a>>>15)+i|0)&i|~a&r)+t[7]-0x2b96aff|0,r+=((n=(n<<22|n>>>10)+a|0)&a|~n&i)+t[8]+0x698098d8|0,i+=((r=(r<<7|r>>>25)+n|0)&n|~r&a)+t[9]-0x74bb0851|0,a+=((i=(i<<12|i>>>20)+r|0)&r|~i&n)+t[10]-42063|0,n+=((a=(a<<17|a>>>15)+i|0)&i|~a&r)+t[11]-0x76a32842|0,r+=((n=(n<<22|n>>>10)+a|0)&a|~n&i)+t[12]+0x6b901122|0,i+=((r=(r<<7|r>>>25)+n|0)&n|~r&a)+t[13]-0x2678e6d|0,a+=((i=(i<<12|i>>>20)+r|0)&r|~i&n)+t[14]-0x5986bc72|0,n+=((a=(a<<17|a>>>15)+i|0)&i|~a&r)+t[15]+0x49b40821|0,r+=((n=(n<<22|n>>>10)+a|0)&i|a&~i)+t[1]-0x9e1da9e|0,i+=((r=(r<<5|r>>>27)+n|0)&a|n&~a)+t[6]-0x3fbf4cc0|0,a+=((i=(i<<9|i>>>23)+r|0)&n|r&~n)+t[11]+0x265e5a51|0,n+=((a=(a<<14|a>>>18)+i|0)&r|i&~r)+t[0]-0x16493856|0,r+=((n=(n<<20|n>>>12)+a|0)&i|a&~i)+t[5]-0x29d0efa3|0,i+=((r=(r<<5|r>>>27)+n|0)&a|n&~a)+t[10]+0x2441453|0,a+=((i=(i<<9|i>>>23)+r|0)&n|r&~n)+t[15]-0x275e197f|0,n+=((a=(a<<14|a>>>18)+i|0)&r|i&~r)+t[4]-0x182c0438|0,r+=((n=(n<<20|n>>>12)+a|0)&i|a&~i)+t[9]+0x21e1cde6|0,i+=((r=(r<<5|r>>>27)+n|0)&a|n&~a)+t[14]-0x3cc8f82a|0,a+=((i=(i<<9|i>>>23)+r|0)&n|r&~n)+t[3]-0xb2af279|0,n+=((a=(a<<14|a>>>18)+i|0)&r|i&~r)+t[8]+0x455a14ed|0,r+=((n=(n<<20|n>>>12)+a|0)&i|a&~i)+t[13]-0x561c16fb|0,i+=((r=(r<<5|r>>>27)+n|0)&a|n&~a)+t[2]-0x3105c08|0,a+=((i=(i<<9|i>>>23)+r|0)&n|r&~n)+t[7]+0x676f02d9|0,n+=((a=(a<<14|a>>>18)+i|0)&r|i&~r)+t[12]-0x72d5b376|0,r+=((n=(n<<20|n>>>12)+a|0)^a^i)+t[5]-378558|0,i+=((r=(r<<4|r>>>28)+n|0)^n^a)+t[8]-0x788e097f|0,a+=((i=(i<<11|i>>>21)+r|0)^r^n)+t[11]+0x6d9d6122|0,n+=((a=(a<<16|a>>>16)+i|0)^i^r)+t[14]-0x21ac7f4|0,r+=((n=(n<<23|n>>>9)+a|0)^a^i)+t[1]-0x5b4115bc|0,i+=((r=(r<<4|r>>>28)+n|0)^n^a)+t[4]+0x4bdecfa9|0,a+=((i=(i<<11|i>>>21)+r|0)^r^n)+t[7]-0x944b4a0|0,n+=((a=(a<<16|a>>>16)+i|0)^i^r)+t[10]-0x41404390|0,r+=((n=(n<<23|n>>>9)+a|0)^a^i)+t[13]+0x289b7ec6|0,i+=((r=(r<<4|r>>>28)+n|0)^n^a)+t[0]-0x155ed806|0,a+=((i=(i<<11|i>>>21)+r|0)^r^n)+t[3]-0x2b10cf7b|0,n+=((a=(a<<16|a>>>16)+i|0)^i^r)+t[6]+0x4881d05|0,r+=((n=(n<<23|n>>>9)+a|0)^a^i)+t[9]-0x262b2fc7|0,i+=((r=(r<<4|r>>>28)+n|0)^n^a)+t[12]-0x1924661b|0,a+=((i=(i<<11|i>>>21)+r|0)^r^n)+t[15]+0x1fa27cf8|0,n+=((a=(a<<16|a>>>16)+i|0)^i^r)+t[2]-0x3b53a99b|0,n=(n<<23|n>>>9)+a|0,r+=(a^(n|~i))+t[0]-0xbd6ddbc|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~a))+t[7]+0x432aff97|0,i=(i<<10|i>>>22)+r|0,a+=(r^(i|~n))+t[14]-0x546bdc59|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~r))+t[5]-0x36c5fc7|0,n=(n<<21|n>>>11)+a|0,r+=(a^(n|~i))+t[12]+0x655b59c3|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~a))+t[3]-0x70f3336e|0,i=(i<<10|i>>>22)+r|0,a+=(r^(i|~n))+t[10]-1051523|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~r))+t[1]-0x7a7ba22f|0,n=(n<<21|n>>>11)+a|0,r+=(a^(n|~i))+t[8]+0x6fa87e4f|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~a))+t[15]-0x1d31920|0,i=(i<<10|i>>>22)+r|0,a+=(r^(i|~n))+t[6]-0x5cfebcec|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~r))+t[13]+0x4e0811a1|0,n=(n<<21|n>>>11)+a|0,r+=(a^(n|~i))+t[4]-0x8ac817e|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~a))+t[11]-0x42c50dcb|0,i=(i<<10|i>>>22)+r|0,a+=(r^(i|~n))+t[2]+0x2ad7d2bb|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~r))+t[9]-0x14792c6f|0,n=(n<<21|n>>>11)+a|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=a+e[2]|0,e[3]=i+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function a(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function i(e){var t,a,i,s,o,u,l=e.length,h=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(t=64;t<=l;t+=64)r(h,n(e.substring(t-64,t)));for(a=(e=e.substring(t-64)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<a;t+=1)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(r(h,i),t=0;t<16;t+=1)i[t]=0;return o=parseInt((s=(s=8*l).toString(16).match(/(.*?)(.{0,8})$/))[2],16),u=parseInt(s[1],16)||0,i[14]=o,i[15]=u,r(h,i),h}function s(e){var r;for(r=0;r<e.length;r+=1)e[r]=function(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}(e[r]);return e.join("")}function o(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function u(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function l(){this.reset()}return s(i("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(t,r){var n,a,i,s,o=this.byteLength,u=e(t,o),l=o;return(void 0!==r&&(l=e(r,o)),u>l)?new ArrayBuffer(0):(i=new Uint8Array(a=new ArrayBuffer(n=l-u)),s=new Uint8Array(this,u,n),i.set(s),a)}}(),l.prototype.append=function(e){return this.appendBinary(o(e)),this},l.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,a=this._buff.length;for(t=64;t<=a;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(e){var t,r,n=this._buff,a=n.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<a;t+=1)i[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(i,a),r=s(this._hash),e&&(r=u(r)),this.reset(),r},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[0x67452301,-0x10325477,-0x67452302,0x10325476],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},l.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(e,t){var n,a,i,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(r(this._hash,e),s=0;s<16;s+=1)e[s]=0;a=parseInt((n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/))[2],16),i=parseInt(n[1],16)||0,e[14]=a,e[15]=i,r(this._hash,e)},l.hash=function(e,t){return l.hashBinary(o(e),t)},l.hashBinary=function(e,t){var r=s(i(e));return t?u(r):r},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(e){var t,n,i,s=(t=this._buff.buffer,(n=new Uint8Array(t.byteLength+e.byteLength)).set(new Uint8Array(t)),n.set(new Uint8Array(e),t.byteLength),n),o=s.length;for(this._length+=e.byteLength,i=64;i<=o;i+=64)r(this._hash,a(s.subarray(i-64,i)));return this._buff=new Uint8Array(i-64<o?s.buffer.slice(i-64):0),this},l.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,a=n.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<a;t+=1)i[t>>2]|=n[t]<<(t%4<<3);return this._finish(i,a),r=s(this._hash),e&&(r=u(r)),this.reset(),r},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[0x67452301,-0x10325477,-0x67452302,0x10325476],this},l.ArrayBuffer.prototype.getState=function(){var e,t=l.prototype.getState.call(this);return e=t.buff,t.buff=String.fromCharCode.apply(null,new Uint8Array(e)),t},l.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,a=new ArrayBuffer(n),i=new Uint8Array(a);for(r=0;r<n;r+=1)i[r]=e.charCodeAt(r);return t?i:a}(e.buff,!0),l.prototype.setState.call(this,e)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(e,t){var n=s(function(e){var t,n,i,s,o,u,l=e.length,h=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(t=64;t<=l;t+=64)r(h,a(e.subarray(t-64,t)));for(n=(e=t-64<l?e.subarray(t-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)i[t>>2]|=e[t]<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(r(h,i),t=0;t<16;t+=1)i[t]=0;return o=parseInt((s=(s=8*l).toString(16).match(/(.*?)(.{0,8})$/))[2],16),u=parseInt(s[1],16)||0,i[14]=o,i[15]=u,r(h,i),h}(new Uint8Array(e)));return t?u(n):n},l}()}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{DatadogNodeServerProvider:()=>v});var e,t,a=r("./spark-md5/spark-md5.js"),i=r.n(a);function s(e,t=""){return new(i())().append(t).append(e).end()}function o(e){return s(JSON.stringify({flag:{key:e.flag.key},subject:{id:e.subject.id,attributes:e.subject.attributes}}))}function u(e){return s(JSON.stringify(e))}class l{constructor(e){this.delegate=e}init(){return Promise.resolve()}has(e){return this.get(e)===u(e)}get(e){return this.delegate.get(o(e))}set(e){this.delegate.set(o(e),u(e))}entries(){return this.delegate.entries()}clear(){this.delegate.clear()}}class h{constructor(e){this.capacity=e,this.cache=new Map,this.size=this.cache.size}[(Symbol.toStringTag,Symbol.iterator)](){return this.cache[Symbol.iterator]()}forEach(e){this.cache.forEach(e)}entries(){return this.cache.entries()}clear(){this.cache.clear()}delete(e){return this.cache.delete(e)}keys(){return this.cache.keys()}values(){return this.cache.values()}has(e){return this.cache.has(e)}get(e){if(!this.has(e))return;let t=this.cache.get(e);return void 0!==t&&(this.delete(e),this.cache.set(e,t)),t}set(e,t){if(0===this.capacity)return this;if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){let e=this.cache.keys().next().value;e&&this.delete(e)}return this.cache.set(e,t),this}}class f extends l{constructor(e){super(new h(e))}}let c=require("@openfeature/server-sdk");(e=t||(t={})).MATCHES="MATCHES",e.NOT_MATCHES="NOT_MATCHES",e.GTE="GTE",e.GT="GT",e.LTE="LTE",e.LT="LT",e.ONE_OF="ONE_OF",e.NOT_ONE_OF="NOT_ONE_OF",e.IS_NULL="IS_NULL";class d{}class g extends d{getShard(e,t){return parseInt(s(e).slice(0,8),16)%t}}function y(e,r,n,a,i,s){if(!e)return{value:a,reason:"ERROR",errorCode:c.ErrorCode.PROVIDER_NOT_READY};let{targetingKey:o,...u}=i;if(!o)return{value:a,reason:"ERROR",errorCode:c.ErrorCode.TARGETING_KEY_MISSING};let l={id:o,...u};try{return function(e,r,n,a,i,s){if(!(null==e?void 0:e.enabled))return s.debug("returning default assignment because flag is disabled",{flagKey:e?e.key:"undefined",subjectKey:n}),{value:i,reason:c.StandardResolutionReasons.DISABLED};if(!function(e,t){if("boolean"===e)return"BOOLEAN"===t;if("string"===e)return"STRING"===t;if("number"===e)return"INTEGER"===t||"NUMERIC"===t;if("object"===e)return"JSON"===t;throw Error(`Invalid expected type: ${e}`)}(r,e.variationType))return s.debug("variant value type mismatch, returning default value",{flagKey:e.key,subjectKey:n,expectedType:r,variantType:e.variationType}),{value:i,reason:c.StandardResolutionReasons.ERROR,errorCode:c.ErrorCode.TYPE_MISMATCH};let o=new Date;for(let r of e.allocations){if(r.startAt&&o<new Date(r.startAt)){s.debug("allocation before start date",{flagKey:e.key,subjectKey:n,allocationKey:r.key,startAt:r.startAt});continue}if(r.endAt&&o>=new Date(r.endAt)){s.debug("allocation after end date",{flagKey:e.key,subjectKey:n,allocationKey:r.key,endAt:r.endAt});continue}if(!function(e,r,n){return null==e||!e.length||(n.debug("evaluating rules",{rules:JSON.stringify(e),subjectAttributes:r}),e.some(e=>!(function(e,r){return r.map(r=>(function(e,r){var n,a,i;let s=e[r.attribute];if(r.operator===t.IS_NULL)return r.value?null==s:null!=s;if(null!=s)switch(r.operator){case t.GTE:case t.GT:case t.LTE:case t.LT:return n=s,a=r.value,((e,n)=>r.operator===t.GTE?e>=n:r.operator===t.GT?e>n:r.operator===t.LTE?e<=n:e<n)(Number(n),Number(a));case t.MATCHES:return new RegExp(r.value).test(String(s));case t.NOT_MATCHES:return!new RegExp(r.value).test(String(s));case t.ONE_OF:return i=s.toString(),r.value.includes(i);case t.NOT_ONE_OF:return function(e,t){return!t.includes(e)}(s.toString(),r.value)}return!1})(e,r))})(r,e.conditions).includes(!1)))}(r.rules,a,s))continue;let i=function(e,t,r,n){if(!e||0===e.length)return null;for(let a of e)if(n.debug("evaluating split sharding",{flagKey:r,subjectKey:t,variationKey:a.variationKey,shards:a.shards}),a.shards.every(e=>{let i=function(e,t,r){var n,a;let i=new g().getShard((n=e.salt,a=t,`${n}-${a}`),e.totalShards);return e.ranges.some(e=>{var t,r;return t=i,(r=e).start<=t&&t<r.end})}(e,t);return n.debug("shard match result",{flagKey:r,subjectKey:t,variationKey:a.variationKey,shard:e,matches:i}),i}))return n.debug("subject matches split",{flagKey:r,subjectKey:t,variationKey:a.variationKey}),a;return n.debug("subject matches no splits",{flagKey:r,subjectKey:t}),null}(r.splits,n,e.key,s);if(i){let t=e.variations[i.variationKey];if(t)return s.debug("evaluated a flag",{flagKey:e.key,subjectKey:n,assignment:t.value}),{value:t.value,reason:c.StandardResolutionReasons.TARGETING_MATCH,variant:t.key,flagMetadata:{allocationKey:r.key,variationType:function(e){if("BOOLEAN"===e)return"boolean";if("STRING"===e)return"string";if("INTEGER"===e||"NUMERIC"===e)return"number";if("JSON"===e)return"object";throw Error(`Cannot convert variant type to flag value type: ${e}`)}(e.variationType),doLog:!!r.doLog}}}else s.debug("no matching split found for subject",{flagKey:e.key,subjectKey:n,allocationKey:r.key})}return s.debug("returning default assignment because no allocation matched",{flagKey:e.key,subjectKey:n}),{value:i,reason:c.StandardResolutionReasons.DEFAULT}}(e.flags[n],r,o,l,a,s)}catch(e){return s.error("Error evaluating flag",{error:e}),{value:a,reason:c.StandardResolutionReasons.ERROR,errorCode:c.ErrorCode.GENERAL}}}class p{constructor(e,t){this.promise=Promise.race([new Promise((e,t)=>{this.resolve=()=>{this.cleanup(),e()},this.reject=e=>{this.cleanup(),t(e)}}),new Promise(()=>{this.timeoutId=setTimeout(()=>{t()},e)})])}async wait(){try{await this.promise}finally{this.cleanup()}}complete(){this.resolve&&this.resolve()}fail(e){this.reject&&this.reject(e)}isInitializing(){return void 0!==this.resolve}cleanup(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.resolve=void 0,this.reject=void 0}}class v{constructor(e){this.options=e,this.metadata={name:"datadog-node-server"},this.runsOn="server",this.hooks=[],this.events=new c.OpenFeatureEventEmitter,this.exposureCache=new f(5e4)}getConfiguration(){return this.configuration}setConfiguration(e){var t,r,n;let a=null==(t=this.configuration)?void 0:t.createdAt,i=!!this.configuration;if(i&&this.configuration!==e){this.events.emit(c.ProviderEvents.ConfigurationChanged),a!==(null==e?void 0:e.createdAt)&&(null==(r=this.exposureCache)||r.clear()),this.configuration=e;return}this.configuration=e,(null==(n=this.initController)?void 0:n.isInitializing())?this.initController.complete():i||this.events.emit(c.ProviderEvents.Ready)}setError(e){var t;(null==(t=this.initController)?void 0:t.isInitializing())?this.initController.fail(e):this.events.emit(c.ProviderEvents.Error,{error:e})}async initialize(){var e,t;if(this.configuration)return;let r=null!=(e=this.options.initializationTimeoutMs)?e:3e4;this.initController=new p(r,()=>this.setError(Error(`Initialization timeout after ${r}ms`))),await this.initController.wait(),await (null==(t=this.exposureCache)?void 0:t.init())}async resolveBooleanEvaluation(e,t,r,n){let a=y(this.configuration,"boolean",e,t,r,n);return this.handleExposure(e,r,a),a}async resolveStringEvaluation(e,t,r,n){let a=y(this.configuration,"string",e,t,r,n);return this.handleExposure(e,r,a),a}async resolveNumberEvaluation(e,t,r,n){let a=y(this.configuration,"number",e,t,r,n);return this.handleExposure(e,r,a),a}async resolveObjectEvaluation(e,t,r,n){let a=y(this.configuration,"object",e,t,r,n);return this.handleExposure(e,r,a),a}handleExposure(e,t,r){var n,a,i;let s=Date.now(),o=function(e,t){var r,n;if(!(null==(r=t.flagMetadata)?void 0:r.doLog))return;let a=null==(n=t.flagMetadata)?void 0:n.allocationKey,i=t.variant;if(!a||!i)return;let{targetingKey:s="",...o}=e;return{allocation:{key:a},flag:{key:t.flagKey},variant:{key:i},subject:{id:s,attributes:o}}}(t,{...r,flagKey:e,flagMetadata:null!=(n=r.flagMetadata)?n:{}});!o||(null==(a=this.exposureCache)?void 0:a.has(o))||this.options.exposureChannel.hasSubscribers&&(this.options.exposureChannel.publish({...o,timestamp:s}),null==(i=this.exposureCache)||i.set(o))}}})(),module.exports=n})();