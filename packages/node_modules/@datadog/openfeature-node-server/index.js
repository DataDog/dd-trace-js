(()=>{var e={694:function(e){e.exports=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],o=e[3];r+=(n&i|~n&o)+t[0]-0x28955b88|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[1]-0x173848aa|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[2]+0x242070db|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[3]-0x3e423112|0,r+=((n=(n<<22|n>>>10)+i|0)&i|~n&o)+t[4]-0xa83f051|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[5]+0x4787c62a|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[6]-0x57cfb9ed|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[7]-0x2b96aff|0,r+=((n=(n<<22|n>>>10)+i|0)&i|~n&o)+t[8]+0x698098d8|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[9]-0x74bb0851|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[10]-42063|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[11]-0x76a32842|0,r+=((n=(n<<22|n>>>10)+i|0)&i|~n&o)+t[12]+0x6b901122|0,o+=((r=(r<<7|r>>>25)+n|0)&n|~r&i)+t[13]-0x2678e6d|0,i+=((o=(o<<12|o>>>20)+r|0)&r|~o&n)+t[14]-0x5986bc72|0,n+=((i=(i<<17|i>>>15)+o|0)&o|~i&r)+t[15]+0x49b40821|0,r+=((n=(n<<22|n>>>10)+i|0)&o|i&~o)+t[1]-0x9e1da9e|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[6]-0x3fbf4cc0|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[11]+0x265e5a51|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[0]-0x16493856|0,r+=((n=(n<<20|n>>>12)+i|0)&o|i&~o)+t[5]-0x29d0efa3|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[10]+0x2441453|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[15]-0x275e197f|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[4]-0x182c0438|0,r+=((n=(n<<20|n>>>12)+i|0)&o|i&~o)+t[9]+0x21e1cde6|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[14]-0x3cc8f82a|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[3]-0xb2af279|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[8]+0x455a14ed|0,r+=((n=(n<<20|n>>>12)+i|0)&o|i&~o)+t[13]-0x561c16fb|0,o+=((r=(r<<5|r>>>27)+n|0)&i|n&~i)+t[2]-0x3105c08|0,i+=((o=(o<<9|o>>>23)+r|0)&n|r&~n)+t[7]+0x676f02d9|0,n+=((i=(i<<14|i>>>18)+o|0)&r|o&~r)+t[12]-0x72d5b376|0,r+=((n=(n<<20|n>>>12)+i|0)^i^o)+t[5]-378558|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[8]-0x788e097f|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[11]+0x6d9d6122|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[14]-0x21ac7f4|0,r+=((n=(n<<23|n>>>9)+i|0)^i^o)+t[1]-0x5b4115bc|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[4]+0x4bdecfa9|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[7]-0x944b4a0|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[10]-0x41404390|0,r+=((n=(n<<23|n>>>9)+i|0)^i^o)+t[13]+0x289b7ec6|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[0]-0x155ed806|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[3]-0x2b10cf7b|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[6]+0x4881d05|0,r+=((n=(n<<23|n>>>9)+i|0)^i^o)+t[9]-0x262b2fc7|0,o+=((r=(r<<4|r>>>28)+n|0)^n^i)+t[12]-0x1924661b|0,i+=((o=(o<<11|o>>>21)+r|0)^r^n)+t[15]+0x1fa27cf8|0,n+=((i=(i<<16|i>>>16)+o|0)^o^r)+t[2]-0x3b53a99b|0,n=(n<<23|n>>>9)+i|0,r+=(i^(n|~o))+t[0]-0xbd6ddbc|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[7]+0x432aff97|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[14]-0x546bdc59|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[5]-0x36c5fc7|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[12]+0x655b59c3|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[3]-0x70f3336e|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[10]-1051523|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[1]-0x7a7ba22f|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[8]+0x6fa87e4f|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[15]-0x1d31920|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[6]-0x5cfebcec|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[13]+0x4e0811a1|0,n=(n<<21|n>>>11)+i|0,r+=(i^(n|~o))+t[4]-0x8ac817e|0,r=(r<<6|r>>>26)+n|0,o+=(n^(r|~i))+t[11]-0x42c50dcb|0,o=(o<<10|o>>>22)+r|0,i+=(r^(o|~n))+t[2]+0x2ad7d2bb|0,i=(i<<15|i>>>17)+o|0,n+=(o^(i|~r))+t[9]-0x14792c6f|0,n=(n<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function o(e){var t,i,o,s,a,l,u=e.length,h=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(t=64;t<=u;t+=64)r(h,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(h,o),t=0;t<16;t+=1)o[t]=0;return a=parseInt((s=(s=8*u).toString(16).match(/(.*?)(.{0,8})$/))[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,r(h,o),h}function s(e){var r;for(r=0;r<e.length;r+=1)e[r]=function(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}(e[r]);return e.join("")}function a(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function l(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function u(){this.reset()}return s(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(t,r){var n,i,o,s,a=this.byteLength,l=e(t,a),u=a;return(void 0!==r&&(u=e(r,a)),l>u)?new ArrayBuffer(0):(o=new Uint8Array(i=new ArrayBuffer(n=u-l)),s=new Uint8Array(this,l,n),o.set(s),i)}}(),u.prototype.append=function(e){return this.appendBinary(a(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=l(r)),this.reset(),r},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[0x67452301,-0x10325477,-0x67452302,0x10325476],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var n,i,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(r(this._hash,e),s=0;s<16;s+=1)e[s]=0;i=parseInt((n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/))[2],16),o=parseInt(n[1],16)||0,e[14]=i,e[15]=o,r(this._hash,e)},u.hash=function(e,t){return u.hashBinary(a(e),t)},u.hashBinary=function(e,t){var r=s(o(e));return t?l(r):r},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(e){var t,n,o,s=(t=this._buff.buffer,(n=new Uint8Array(t.byteLength+e.byteLength)).set(new Uint8Array(t)),n.set(new Uint8Array(e),t.byteLength),n),a=s.length;for(this._length+=e.byteLength,o=64;o<=a;o+=64)r(this._hash,i(s.subarray(o-64,o)));return this._buff=new Uint8Array(o-64<a?s.buffer.slice(o-64):0),this},u.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=s(this._hash),e&&(r=l(r)),this.reset(),r},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[0x67452301,-0x10325477,-0x67452302,0x10325476],this},u.ArrayBuffer.prototype.getState=function(){var e,t=u.prototype.getState.call(this);return e=t.buff,t.buff=String.fromCharCode.apply(null,new Uint8Array(e)),t},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}(e.buff,!0),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){var n=s(function(e){var t,n,o,s,a,l,u=e.length,h=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(t=64;t<=u;t+=64)r(h,i(e.subarray(t-64,t)));for(n=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(r(h,o),t=0;t<16;t+=1)o[t]=0;return a=parseInt((s=(s=8*u).toString(16).match(/(.*?)(.{0,8})$/))[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,r(h,o),h}(new Uint8Array(e)));return t?l(n):n},u}()},984:function(e,t,r){"use strict";r.d(t,{ErrorCode:()=>E,GenericEventEmitter:()=>H,OpenFeatureCommonAPI:()=>V,ProviderFatalError:()=>O,ProviderNotReadyError:()=>A,ProviderWrapper:()=>F,SafeLogger:()=>k,ServerProviderEvents:()=>S,ServerProviderStatus:()=>T,StandardResolutionReasons:()=>p,instantiateErrorByErrorCode:()=>P,objectOrUndefined:()=>M,statusMatchesEvent:()=>D,stringOrUndefined:()=>j});var n,i,o,s,a=Object.defineProperty,l=Object.defineProperties,u=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,f=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))d.call(t,r)&&f(e,r,t[r]);if(h)for(var r of h(t))c.call(t,r)&&f(e,r,t[r]);return e},g=(e,t,r)=>new Promise((n,i)=>{var o=e=>{try{a(r.next(e))}catch(e){i(e)}},s=e=>{try{a(r.throw(e))}catch(e){i(e)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,s);a((r=r.apply(e,t)).next())}),p={STATIC:"STATIC",DEFAULT:"DEFAULT",TARGETING_MATCH:"TARGETING_MATCH",SPLIT:"SPLIT",CACHED:"CACHED",DISABLED:"DISABLED",UNKNOWN:"UNKNOWN",STALE:"STALE",ERROR:"ERROR"},E=((n=E||{}).PROVIDER_NOT_READY="PROVIDER_NOT_READY",n.PROVIDER_FATAL="PROVIDER_FATAL",n.FLAG_NOT_FOUND="FLAG_NOT_FOUND",n.PARSE_ERROR="PARSE_ERROR",n.TYPE_MISMATCH="TYPE_MISMATCH",n.TARGETING_KEY_MISSING="TARGETING_KEY_MISSING",n.INVALID_CONTEXT="INVALID_CONTEXT",n.GENERAL="GENERAL",n),_=class e extends Error{constructor(t,r){super(t),Object.setPrototypeOf(this,e.prototype),this.name="OpenFeatureError",this.cause=null==r?void 0:r.cause}},y=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="FlagNotFoundError",this.code="FLAG_NOT_FOUND"}},m=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="GeneralError",this.code="GENERAL"}},R=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="InvalidContextError",this.code="INVALID_CONTEXT"}},b=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="ParseError",this.code="PARSE_ERROR"}},O=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="ProviderFatalError",this.code="PROVIDER_FATAL"}},A=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="ProviderNotReadyError",this.code="PROVIDER_NOT_READY"}},x=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="TargetingKeyMissingError",this.code="TARGETING_KEY_MISSING"}},C=class e extends _{constructor(t,r){super(t,r),Object.setPrototypeOf(this,e.prototype),this.name="TypeMismatchError",this.code="TYPE_MISMATCH"}},P=(e,t)=>{switch(e){case"FLAG_NOT_FOUND":return new y(t);case"PARSE_ERROR":return new b(t);case"TYPE_MISMATCH":return new C(t);case"TARGETING_KEY_MISSING":return new x(t);case"INVALID_CONTEXT":return new R(t);case"PROVIDER_NOT_READY":return new A(t);case"PROVIDER_FATAL":return new O(t);default:return new m(t)}},T=((i=T||{}).NOT_READY="NOT_READY",i.READY="READY",i.ERROR="ERROR",i.STALE="STALE",i.FATAL="FATAL",i),S=((o=S||{}).Ready="PROVIDER_READY",o.Error="PROVIDER_ERROR",o.ConfigurationChanged="PROVIDER_CONFIGURATION_CHANGED",o.Stale="PROVIDER_STALE",o),N=((s=N||{}).Ready="PROVIDER_READY",s.Error="PROVIDER_ERROR",s.ConfigurationChanged="PROVIDER_CONFIGURATION_CHANGED",s.ContextChanged="PROVIDER_CONTEXT_CHANGED",s.Reconciling="PROVIDER_RECONCILING",s.Stale="PROVIDER_STALE",s),I={READY:"PROVIDER_READY",ERROR:"PROVIDER_ERROR",FATAL:"PROVIDER_ERROR",STALE:"PROVIDER_STALE",RECONCILING:"PROVIDER_RECONCILING",NOT_READY:void 0},D=(e,t)=>!t&&"PROVIDER_READY"===e||I[t]===e,w=class{error(...e){console.error(...e)}warn(...e){console.warn(...e)}info(){}debug(){}},L=["error","warn","info","debug"],k=class{constructor(e){this.fallbackLogger=new w;try{for(const t of L)if(!e[t]||"function"!=typeof e[t])throw Error(`The provided logger is missing the ${t} method.`);this.logger=e}catch(e){console.error(e),console.error("Falling back to the default logger."),this.logger=this.fallbackLogger}}error(...e){this.log("error",...e)}warn(...e){this.log("warn",...e)}info(...e){this.log("info",...e)}debug(...e){this.log("debug",...e)}log(e,...t){try{this.logger[e](...t)}catch(r){this.fallbackLogger[e](...t)}}},H=class{constructor(e){this.globalLogger=e,this._handlers={PROVIDER_CONFIGURATION_CHANGED:new WeakMap,PROVIDER_CONTEXT_CHANGED:new WeakMap,PROVIDER_READY:new WeakMap,PROVIDER_ERROR:new WeakMap,PROVIDER_STALE:new WeakMap,PROVIDER_RECONCILING:new WeakMap}}emit(e,t){this.eventEmitter.emit(e,t)}addHandler(e,t){let r=e=>g(this,null,function*(){var r;try{yield t(e)}catch(e){null==(r=this._logger)||r.error("Error running event handler:",e)}}),n=this._handlers[e].get(t);this._handlers[e].set(t,[...n||[],r]),this.eventEmitter.on(e,r)}removeHandler(e,t){let r=this._handlers[e].get(t);if(r){let t=r.pop();t&&this.eventEmitter.removeListener(e,t)}}removeAllHandlers(e){e?this.eventEmitter.removeAllListeners(e):this.eventEmitter.removeAllListeners()}getHandlers(e){return this.eventEmitter.listeners(e)}setLogger(e){return this._eventLogger=new k(e),this}get _logger(){var e,t;return null!=(t=this._eventLogger)?t:null==(e=this.globalLogger)?void 0:e.call(this)}};function j(e){return"string"==typeof e?e:void 0}function M(e){return"object"==typeof e?e:void 0}function G(e){return null!=e}var F=class{constructor(e,t,r){var n,i,o;this._provider=e,this._status=t,this._pendingContextChanges=0,null==(n=e.events)||n.addHandler("PROVIDER_READY",()=>{this._status=r.READY}),null==(i=e.events)||i.addHandler("PROVIDER_STALE",()=>{this._status=r.STALE}),null==(o=e.events)||o.addHandler("PROVIDER_ERROR",e=>{(null==e?void 0:e.errorCode)==="PROVIDER_FATAL"?this._status=r.FATAL:this._status=r.ERROR})}get provider(){return this._provider}set provider(e){this._provider=e}get status(){return this._status}set status(e){this._status=e}get allContextChangesSettled(){return 0===this._pendingContextChanges}incrementPendingContextChanges(){this._pendingContextChanges++}decrementPendingContextChanges(){this._pendingContextChanges--}},V=class{constructor(e){this._hooks=[],this._context={},this._logger=new w,this._clientEventHandlers=new Map,this._domainScopedContext=new Map,this._clientEvents=new Map,this._runsOn=e}addHooks(...e){return this._hooks=[...this._hooks,...e],this}getHooks(){return this._hooks}clearHooks(){return this._hooks=[],this}setLogger(e){return this._logger=new k(e),this}get providerMetadata(){return this.getProviderMetadata()}getProviderMetadata(e){return this.getProviderForClient(e).metadata}addHandler(e,t,r){[...new Map([[void 0,this._defaultProvider]]),...this._domainScopedProviders].forEach(r=>{var n;let i=r[0],o=r[1].provider;if(D(e,r[1].status))try{t({domain:i,providerName:o.metadata.name})}catch(e){null==(n=this._logger)||n.error("Error running event handler:",e)}}),this._apiEmitter.addHandler(e,t),(null==r?void 0:r.signal)&&"function"==typeof r.signal.addEventListener&&r.signal.addEventListener("abort",()=>{this.removeHandler(e,t)})}removeHandler(e,t){this._apiEmitter.removeHandler(e,t)}clearHandlers(){this._apiEmitter.removeAllHandlers()}getHandlers(e){return this._apiEmitter.getHandlers(e)}setAwaitableProvider(e,t){var r,n,i,o,s,a,l,u;let h,d=j(e),c=null!=(r=M(e))?r:M(t);if(!c)return void this._logger.debug("No provider defined, ignoring setProvider call");let f=this.getProviderForClient(d),v=c.metadata.name;if(f===c)return void this._logger.debug("Provider is already set, ignoring setProvider call");if(c.runsOn){if(c.runsOn!==this._runsOn)throw new m(`Provider '${c.metadata.name}' is intended for use on the ${c.runsOn}.`)}else this._logger.debug(`Provider '${c.metadata.name}' has not defined its intended use.`);let g=this.getAssociatedEventEmitters(d),p=new F(c,this._statusEnumType.NOT_READY,this._statusEnumType);return"function"!=typeof c.initialize||this.allProviders.includes(c)?(p.status=this._statusEnumType.READY,g.forEach(e=>{null==e||e.emit("PROVIDER_READY",{clientName:d,domain:d,providerName:v})}),null==(a=this._apiEmitter)||a.emit("PROVIDER_READY",{clientName:d,domain:d,providerName:v})):h=null==(s=null==(o=null==(i=c.initialize)?void 0:i.call(c,d&&null!=(n=this._domainScopedContext.get(d))?n:this._context))?void 0:o.then(()=>{var e;p.status=this._statusEnumType.READY,this.getAssociatedEventEmitters(d).forEach(e=>{null==e||e.emit("PROVIDER_READY",{clientName:d,domain:d,providerName:v})}),null==(e=this._apiEmitter)||e.emit("PROVIDER_READY",{clientName:d,domain:d,providerName:v})}))?void 0:s.catch(e=>{var t;throw(null==e?void 0:e.code)==="PROVIDER_FATAL"?p.status=this._statusEnumType.FATAL:p.status=this._statusEnumType.ERROR,this.getAssociatedEventEmitters(d).forEach(t=>{null==t||t.emit("PROVIDER_ERROR",{clientName:d,domain:d,providerName:v,message:null==e?void 0:e.message})}),null==(t=this._apiEmitter)||t.emit("PROVIDER_ERROR",{clientName:d,domain:d,providerName:v,message:null==e?void 0:e.message}),e}),d?this._domainScopedProviders.set(d,p):this._defaultProvider=p,this.transferListeners(f,c,d,g),this.allProviders.includes(f)||null==(u=null==(l=null==f?void 0:f.onClose)?void 0:l.call(f))||u.catch(e=>{this._logger.error(`error closing provider: ${null==e?void 0:e.message}, ${null==e?void 0:e.stack}`)}),h}getProviderForClient(e){var t,r;return e&&null!=(r=null==(t=this._domainScopedProviders.get(e))?void 0:t.provider)?r:this._defaultProvider.provider}buildAndCacheEventEmitterForClient(e){let t=this._clientEvents.get(e);if(t)return t;let r=this._createEventEmitter();this._clientEvents.set(e,r);let n=this.getProviderForClient(e);return Object.values(N).forEach(t=>{var i;return null==(i=n.events)?void 0:i.addHandler(t,i=>g(this,null,function*(){r.emit(t,l(v({},i),u({clientName:e,domain:e,providerName:n.metadata.name})))}))}),r}getUnboundEmitters(){let e=[...this._domainScopedProviders.keys()];return[...[...this._clientEvents.keys()].filter(G).filter(t=>!e.includes(t)).map(e=>this._clientEvents.get(e)),this._clientEvents.get(void 0)].filter(G)}getAssociatedEventEmitters(e){return e?[this.buildAndCacheEventEmitterForClient(e)]:this.getUnboundEmitters()}transferListeners(e,t,r,n){var i;null==(i=this._clientEventHandlers.get(r))||i.forEach(t=>{var r;return null==(r=e.events)?void 0:r.removeHandler(...t)});let o=Object.values(N).map(e=>{let i=i=>g(this,null,function*(){n.forEach(n=>{null==n||n.emit(e,l(v({},i),u({clientName:r,domain:r,providerName:t.metadata.name})))}),this._apiEmitter.emit(e,l(v({},i),u({clientName:r,domain:r,providerName:t.metadata.name})))});return[e,i]});this._clientEventHandlers.set(r,o),o.forEach(e=>{var r;return null==(r=t.events)?void 0:r.addHandler(...e)})}close(){return g(this,null,function*(){var e,t;try{yield null==(t=null==(e=this==null?void 0:this._defaultProvider.provider)?void 0:e.onClose)?void 0:t.call(e)}catch(e){this.handleShutdownError(this._defaultProvider.provider,e)}let r=Array.from(this._domainScopedProviders);yield Promise.all(r.map(e=>g(this,[e],function*([,e]){var t,r;try{yield null==(r=null==e?void 0:(t=e.provider).onClose)?void 0:r.call(t)}catch(t){this.handleShutdownError(null==e?void 0:e.provider,t)}})))})}clearProvidersAndSetDefault(e){return g(this,null,function*(){try{yield this.close()}catch(e){this._logger.error("Unable to cleanly close providers. Resetting to the default configuration.")}finally{this._domainScopedProviders.clear(),this._defaultProvider=new F(e,this._statusEnumType.NOT_READY,this._statusEnumType)}})}get allProviders(){return[...[...this._domainScopedProviders.values()].map(e=>e.provider),this._defaultProvider.provider]}handleShutdownError(e,t){this._logger.error(`Error during shutdown of provider ${e.metadata.name}: ${t}`),this._logger.error(null==t?void 0:t.stack)}}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{DatadogNodeServerProvider:()=>w});var e,t,i=r(694),o=r.n(i);function s(e,t=""){return new(o())().append(t).append(e).end()}function a(e){return s(JSON.stringify({flag:{key:e.flag.key},subject:{id:e.subject.id,attributes:e.subject.attributes}}))}function l(e){return s(JSON.stringify(e))}class u{constructor(e){this.delegate=e}init(){return Promise.resolve()}has(e){return this.get(e)===l(e)}get(e){return this.delegate.get(a(e))}set(e){this.delegate.set(a(e),l(e))}entries(){return this.delegate.entries()}clear(){this.delegate.clear()}}class h{constructor(e){this.capacity=e,this.cache=new Map,this.size=this.cache.size}[(Symbol.toStringTag,Symbol.iterator)](){return this.cache[Symbol.iterator]()}forEach(e){this.cache.forEach(e)}entries(){return this.cache.entries()}clear(){this.cache.clear()}delete(e){return this.cache.delete(e)}keys(){return this.cache.keys()}values(){return this.cache.values()}has(e){return this.cache.has(e)}get(e){if(!this.has(e))return;let t=this.cache.get(e);return void 0!==t&&(this.delete(e),this.cache.set(e,t)),t}set(e,t){if(0===this.capacity)return this;if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){let e=this.cache.keys().next().value;e&&this.delete(e)}return this.cache.set(e,t),this}}class d extends u{constructor(e){super(new h(e))}}var c=r(984);let f=require("node:events");require("async_hooks");var v=Object.defineProperty,g=Object.defineProperties,p=Object.getOwnPropertyDescriptors,E=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,m=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,R=(e,t)=>{for(var r in t||(t={}))_.call(t,r)&&m(e,r,t[r]);if(E)for(var r of E(t))y.call(t,r)&&m(e,r,t[r]);return e},b=(e,t,r)=>new Promise((n,i)=>{var o=e=>{try{a(r.next(e))}catch(e){i(e)}},s=e=>{try{a(r.throw(e))}catch(e){i(e)}},a=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,s);a((r=r.apply(e,t)).next())}),O=new class{constructor(){this.metadata={name:"No-op Provider"}}resolveBooleanEvaluation(e,t){return this.noOp(t)}resolveStringEvaluation(e,t){return this.noOp(t)}resolveNumberEvaluation(e,t){return this.noOp(t)}resolveObjectEvaluation(e,t){return this.noOp(t)}noOp(e){return Promise.resolve({value:e,reason:"No-op"})}},A=class{constructor(e,t,r,n,i,o,s,a,l={}){this.providerAccessor=e,this.providerStatusAccessor=t,this.emitterAccessor=r,this.apiContextAccessor=n,this.apiHooksAccessor=i,this.transactionContextAccessor=o,this.globalLogger=s,this.options=a,this._hooks=[],this._context=l}get metadata(){var e,t;return{name:null!=(e=this.options.domain)?e:this.options.name,domain:null!=(t=this.options.domain)?t:this.options.name,version:this.options.version,providerMetadata:this.providerAccessor().metadata}}get providerStatus(){return this.providerStatusAccessor()}addHandler(e,t,r){var n;if(this.emitterAccessor().addHandler(e,t),(0,c.statusMatchesEvent)(e,this._providerStatus))try{t({clientName:this.metadata.name,domain:this.metadata.domain,providerName:this._provider.metadata.name})}catch(e){null==(n=this._logger)||n.error("Error running event handler:",e)}(null==r?void 0:r.signal)&&"function"==typeof r.signal.addEventListener&&r.signal.addEventListener("abort",()=>{this.removeHandler(e,t)})}removeHandler(e,t){this.emitterAccessor().removeHandler(e,t)}getHandlers(e){return this.emitterAccessor().getHandlers(e)}setLogger(e){return this._clientLogger=new c.SafeLogger(e),this}setContext(e){return this._context=e,this}getContext(){return this._context}addHooks(...e){return this._hooks=[...this._hooks,...e],this}getHooks(){return this._hooks}clearHooks(){return this._hooks=[],this}getBooleanValue(e,t,r,n){return b(this,null,function*(){return(yield this.getBooleanDetails(e,t,r,n)).value})}getBooleanDetails(e,t,r,n){return this.evaluate(e,this._provider.resolveBooleanEvaluation,t,"boolean",r,n)}getStringValue(e,t,r,n){return b(this,null,function*(){return(yield this.getStringDetails(e,t,r,n)).value})}getStringDetails(e,t,r,n){return this.evaluate(e,this._provider.resolveStringEvaluation,t,"string",r,n)}getNumberValue(e,t,r,n){return b(this,null,function*(){return(yield this.getNumberDetails(e,t,r,n)).value})}getNumberDetails(e,t,r,n){return this.evaluate(e,this._provider.resolveNumberEvaluation,t,"number",r,n)}getObjectValue(e,t,r,n){return b(this,null,function*(){return(yield this.getObjectDetails(e,t,r,n)).value})}getObjectDetails(e,t,r,n){return this.evaluate(e,this._provider.resolveObjectEvaluation,t,"object",r,n)}track(e,t={},r={}){var n,i;try{if(this.shortCircuitIfNotReady(),"function"==typeof this._provider.track){let o=Object.freeze(this.mergeContexts(t));return null==(i=(n=this._provider).track)?void 0:i.call(n,e,o,r)}this._logger.debug("Provider does not support the track function; will no-op.")}catch(e){this._logger.debug("Error recording tracking event.",e)}}evaluate(e,t,r,n){return b(this,arguments,function*(e,t,r,n,i={},o={}){var s;let a,l=[...this.apiHooksAccessor(),...this.getHooks(),...o.hooks||[],...this._provider.hooks||[]],u=[...l].reverse(),h=this.mergeContexts(i),d={flagKey:e,defaultValue:r,flagValueType:n,clientMetadata:this.metadata,providerMetadata:this._provider.metadata,context:h,logger:this._logger};try{let n,i,h=yield this.beforeHooks(l,d,o);this.shortCircuitIfNotReady();let f=yield t.call(this._provider,e,r,h,this._logger),v=(n=R({},f),i={flagMetadata:Object.freeze(null!=(s=f.flagMetadata)?s:{}),flagKey:e},g(n,p(i)));if(v.errorCode){let t=(0,c.instantiateErrorByErrorCode)(v.errorCode,v.errorMessage);yield this.errorHooks(u,d,t,o),a=this.getErrorEvaluationDetails(e,r,t,v.flagMetadata)}else yield this.afterHooks(u,d,v,o),a=v}catch(t){yield this.errorHooks(u,d,t,o),a=this.getErrorEvaluationDetails(e,r,t)}return yield this.finallyHooks(u,d,a,o),a})}beforeHooks(e,t,r){return b(this,null,function*(){var n;for(let i of e)Object.freeze(t),Object.assign(t.context,R(R({},t.context),(yield null==(n=null==i?void 0:i.before)?void 0:n.call(i,t,Object.freeze(r.hookHints)))));return Object.freeze(t.context)})}afterHooks(e,t,r,n){return b(this,null,function*(){var i;for(let o of e)yield null==(i=null==o?void 0:o.after)?void 0:i.call(o,t,r,n.hookHints)})}errorHooks(e,t,r,n){return b(this,null,function*(){var i;for(let o of e)try{yield null==(i=null==o?void 0:o.error)?void 0:i.call(o,t,r,n.hookHints)}catch(e){this._logger.error(`Unhandled error during 'error' hook: ${e}`),e instanceof Error&&this._logger.error(e.stack),this._logger.error(null==e?void 0:e.stack)}})}finallyHooks(e,t,r,n){return b(this,null,function*(){var i;for(let o of e)try{yield null==(i=null==o?void 0:o.finally)?void 0:i.call(o,t,r,n.hookHints)}catch(e){this._logger.error(`Unhandled error during 'finally' hook: ${e}`),e instanceof Error&&this._logger.error(e.stack),this._logger.error(null==e?void 0:e.stack)}})}get _provider(){return this.providerAccessor()}get _providerStatus(){return this.providerStatusAccessor()}get _logger(){return this._clientLogger||this.globalLogger()}mergeContexts(e){return R(R(R(R({},this.apiContextAccessor()),this.transactionContextAccessor()),this._context),e)}shortCircuitIfNotReady(){if(this.providerStatus===c.ServerProviderStatus.NOT_READY)throw new c.ProviderNotReadyError("provider has not yet initialized");if(this.providerStatus===c.ServerProviderStatus.FATAL)throw new c.ProviderFatalError("provider is in an irrecoverable error state")}getErrorEvaluationDetails(e,t,r,n={}){let i=null==r?void 0:r.message;return{errorCode:(null==r?void 0:r.code)||c.ErrorCode.GENERAL,errorMessage:i,value:t,reason:c.StandardResolutionReasons.ERROR,flagMetadata:Object.freeze(n),flagKey:e}}},x=class extends c.GenericEventEmitter{constructor(){super(),this.eventEmitter=new f.EventEmitter({captureRejections:!0}),this.eventEmitter.on("error",e=>{var t;null==(t=this._logger)||t.error("Error running event handler:",e)})}},C=new class{getTransactionContext(){return{}}setTransactionContext(e,t,...r){t(...r)}},P=Symbol.for("@openfeature/js-sdk/api"),T=globalThis;(class e extends c.OpenFeatureCommonAPI{constructor(){super("server"),this._statusEnumType=c.ServerProviderStatus,this._apiEmitter=new x,this._defaultProvider=new c.ProviderWrapper(O,c.ServerProviderStatus.NOT_READY,this._statusEnumType),this._domainScopedProviders=new Map,this._createEventEmitter=()=>new x,this._transactionContextPropagator=C}static getInstance(){let t=T[P];if(t)return t;let r=new e;return T[P]=r,r}getProviderStatus(e){var t,r;return e&&null!=(r=null==(t=this._domainScopedProviders.get(e))?void 0:t.status)?r:this._defaultProvider.status}setProviderAndWait(e,t){return b(this,null,function*(){let r=(0,c.stringOrUndefined)(e),n=r?(0,c.objectOrUndefined)(t):(0,c.objectOrUndefined)(e);yield this.setAwaitableProvider(r,n)})}setProvider(e,t){let r=(0,c.stringOrUndefined)(e),n=r?(0,c.objectOrUndefined)(t):(0,c.objectOrUndefined)(e);return Promise.resolve(this.setAwaitableProvider(r,n)).catch(e=>{this._logger.error("Error during provider initialization:",e)}),this}getProvider(e){return this.getProviderForClient(e)}setContext(e){return this._context=e,this}getContext(){return this._context}getClient(e,t,r){var n,i;let o=(0,c.stringOrUndefined)(e);return new A(()=>this.getProviderForClient(o),()=>this.getProviderStatus(o),()=>this.buildAndCacheEventEmitterForClient(o),()=>this.getContext(),()=>this.getHooks(),()=>this.getTransactionContext(),()=>this._logger,{domain:o,version:(0,c.stringOrUndefined)(t)},null!=(i=null!=(n=(0,c.objectOrUndefined)(e))?n:(0,c.objectOrUndefined)(t))?i:(0,c.objectOrUndefined)(r))}clearProviders(){return super.clearProvidersAndSetDefault(O)}setTransactionContextPropagator(e){let t="Invalid TransactionContextPropagator, will not be set: ";return"function"!=typeof(null==e?void 0:e.getTransactionContext)?this._logger.error(`${t}: getTransactionContext is not a function.`):"function"!=typeof(null==e?void 0:e.setTransactionContext)?this._logger.error(`${t}: setTransactionContext is not a function.`):this._transactionContextPropagator=e,this}setTransactionContext(e,t,...r){this._transactionContextPropagator.setTransactionContext(e,t,...r)}getTransactionContext(){try{return this._transactionContextPropagator.getTransactionContext()}catch(e){return this._logger.error(`Error getting transaction context: ${null==e?void 0:e.message}, returning empty context.`),this._logger.error(null==e?void 0:e.stack),{}}}}).getInstance(),(e=t||(t={})).MATCHES="MATCHES",e.NOT_MATCHES="NOT_MATCHES",e.GTE="GTE",e.GT="GT",e.LTE="LTE",e.LT="LT",e.ONE_OF="ONE_OF",e.NOT_ONE_OF="NOT_ONE_OF",e.IS_NULL="IS_NULL";class S{}class N extends S{getShard(e,t){return parseInt(s(e).slice(0,8),16)%t}}function I(e,r,n,i,o,s){if(!e)return{value:i,reason:"ERROR",errorCode:c.ErrorCode.PROVIDER_NOT_READY};let{targetingKey:a,...l}=o;if(!a)return{value:i,reason:"ERROR",errorCode:c.ErrorCode.TARGETING_KEY_MISSING};let u={id:a,...l};try{return function(e,r,n,i,o,s){if(!(null==e?void 0:e.enabled))return s.debug("returning default assignment because flag is disabled",{flagKey:e?e.key:"undefined",subjectKey:n}),{value:o,reason:c.StandardResolutionReasons.DISABLED};if(!function(e,t){if("boolean"===e)return"BOOLEAN"===t;if("string"===e)return"STRING"===t;if("number"===e)return"INTEGER"===t||"NUMERIC"===t;if("object"===e)return"JSON"===t;throw Error(`Invalid expected type: ${e}`)}(r,e.variationType))return s.debug("variant value type mismatch, returning default value",{flagKey:e.key,subjectKey:n,expectedType:r,variantType:e.variationType}),{value:o,reason:c.StandardResolutionReasons.ERROR,errorCode:c.ErrorCode.TYPE_MISMATCH};let a=new Date;for(let r of e.allocations){if(r.startAt&&a<new Date(r.startAt)){s.debug("allocation before start date",{flagKey:e.key,subjectKey:n,allocationKey:r.key,startAt:r.startAt});continue}if(r.endAt&&a>=new Date(r.endAt)){s.debug("allocation after end date",{flagKey:e.key,subjectKey:n,allocationKey:r.key,endAt:r.endAt});continue}if(!function(e,r,n){return null==e||!e.length||(n.debug("evaluating rules",{rules:JSON.stringify(e),subjectAttributes:r}),e.some(e=>!(function(e,r){return r.map(r=>(function(e,r){var n,i,o;let s=e[r.attribute];if(r.operator===t.IS_NULL)return r.value?null==s:null!=s;if(null!=s)switch(r.operator){case t.GTE:case t.GT:case t.LTE:case t.LT:return n=s,i=r.value,((e,n)=>r.operator===t.GTE?e>=n:r.operator===t.GT?e>n:r.operator===t.LTE?e<=n:e<n)(Number(n),Number(i));case t.MATCHES:return new RegExp(r.value).test(String(s));case t.NOT_MATCHES:return!new RegExp(r.value).test(String(s));case t.ONE_OF:return o=s.toString(),r.value.includes(o);case t.NOT_ONE_OF:return function(e,t){return!t.includes(e)}(s.toString(),r.value)}return!1})(e,r))})(r,e.conditions).includes(!1)))}(r.rules,i,s))continue;let o=function(e,t,r,n){if(!e||0===e.length)return null;for(let i of e)if(n.debug("evaluating split sharding",{flagKey:r,subjectKey:t,variationKey:i.variationKey,shards:i.shards}),i.shards.every(e=>{let o=function(e,t,r){var n,i;let o=new N().getShard((n=e.salt,i=t,`${n}-${i}`),e.totalShards);return e.ranges.some(e=>{var t,r;return t=o,(r=e).start<=t&&t<r.end})}(e,t);return n.debug("shard match result",{flagKey:r,subjectKey:t,variationKey:i.variationKey,shard:e,matches:o}),o}))return n.debug("subject matches split",{flagKey:r,subjectKey:t,variationKey:i.variationKey}),i;return n.debug("subject matches no splits",{flagKey:r,subjectKey:t}),null}(r.splits,n,e.key,s);if(o){let t=e.variations[o.variationKey];if(t)return s.debug("evaluated a flag",{flagKey:e.key,subjectKey:n,assignment:t.value}),{value:t.value,reason:c.StandardResolutionReasons.TARGETING_MATCH,variant:t.key,flagMetadata:{allocationKey:r.key,variationType:function(e){if("BOOLEAN"===e)return"boolean";if("STRING"===e)return"string";if("INTEGER"===e||"NUMERIC"===e)return"number";if("JSON"===e)return"object";throw Error(`Cannot convert variant type to flag value type: ${e}`)}(e.variationType),doLog:!!r.doLog}}}else s.debug("no matching split found for subject",{flagKey:e.key,subjectKey:n,allocationKey:r.key})}return s.debug("returning default assignment because no allocation matched",{flagKey:e.key,subjectKey:n}),{value:o,reason:c.StandardResolutionReasons.DEFAULT}}(e.flags[n],r,a,u,i,s)}catch(e){return s.error("Error evaluating flag",{error:e}),{value:i,reason:c.StandardResolutionReasons.ERROR,errorCode:c.ErrorCode.GENERAL}}}class D{constructor(e,t){this.promise=Promise.race([new Promise((e,t)=>{this.resolve=()=>{this.cleanup(),e()},this.reject=e=>{this.cleanup(),t(e)}}),new Promise(()=>{this.timeoutId=setTimeout(()=>{t()},e)})])}async wait(){try{await this.promise}finally{this.cleanup()}}complete(){this.resolve&&this.resolve()}fail(e){this.reject&&this.reject(e)}isInitializing(){return void 0!==this.resolve}cleanup(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.resolve=void 0,this.reject=void 0}}class w{constructor(e){this.options=e,this.metadata={name:"datadog-node-server"},this.runsOn="server",this.hooks=[],this.events=new x,this.exposureCache=new d(5e4)}getConfiguration(){return this.configuration}setConfiguration(e){var t,r,n;let i=null==(t=this.configuration)?void 0:t.createdAt,o=!!this.configuration;if(o&&this.configuration!==e){this.events.emit(c.ServerProviderEvents.ConfigurationChanged),i!==(null==e?void 0:e.createdAt)&&(null==(r=this.exposureCache)||r.clear()),this.configuration=e;return}this.configuration=e,(null==(n=this.initController)?void 0:n.isInitializing())?this.initController.complete():o||this.events.emit(c.ServerProviderEvents.Ready)}setError(e){var t;(null==(t=this.initController)?void 0:t.isInitializing())?this.initController.fail(e):this.events.emit(c.ServerProviderEvents.Error,{error:e})}async initialize(){var e,t;if(this.configuration)return;let r=null!=(e=this.options.initializationTimeoutMs)?e:3e4;this.initController=new D(r,()=>this.setError(Error(`Initialization timeout after ${r}ms`))),await this.initController.wait(),await (null==(t=this.exposureCache)?void 0:t.init())}async resolveBooleanEvaluation(e,t,r,n){let i=I(this.configuration,"boolean",e,t,r,n);return this.handleExposure(e,r,i),i}async resolveStringEvaluation(e,t,r,n){let i=I(this.configuration,"string",e,t,r,n);return this.handleExposure(e,r,i),i}async resolveNumberEvaluation(e,t,r,n){let i=I(this.configuration,"number",e,t,r,n);return this.handleExposure(e,r,i),i}async resolveObjectEvaluation(e,t,r,n){let i=I(this.configuration,"object",e,t,r,n);return this.handleExposure(e,r,i),i}handleExposure(e,t,r){var n,i,o;let s=Date.now(),a=function(e,t){var r,n;if(!(null==(r=t.flagMetadata)?void 0:r.doLog))return;let i=null==(n=t.flagMetadata)?void 0:n.allocationKey,o=t.variant;if(!i||!o)return;let{targetingKey:s="",...a}=e;return{allocation:{key:i},flag:{key:t.flagKey},variant:{key:o},subject:{id:s,attributes:a}}}(t,{...r,flagKey:e,flagMetadata:null!=(n=r.flagMetadata)?n:{}});!a||(null==(i=this.exposureCache)?void 0:i.has(a))||this.options.exposureChannel.hasSubscribers&&(this.options.exposureChannel.publish({...a,timestamp:s}),null==(o=this.exposureCache)||o.set(a))}}})(),module.exports=n})();