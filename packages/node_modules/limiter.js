(()=>{var t={3065:(t,e,n)=>{var i=n(5472),r=n(3085),s=function(t,e,n){this.tokenBucket=new i(t,t,e,null),this.tokenBucket.content=t,this.curIntervalStart=r(),this.tokensThisInterval=0,this.fireImmediately=n};s.prototype={tokenBucket:null,curIntervalStart:0,tokensThisInterval:0,fireImmediately:!1,removeTokens:function(t,e){if(t>this.tokenBucket.bucketSize)return process.nextTick(e.bind(null,"Requested tokens "+t+" exceeds maximum tokens per interval "+this.tokenBucket.bucketSize,null)),!1;var n=this,i=r();if((i<this.curIntervalStart||i-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=i,this.tokensThisInterval=0),t>this.tokenBucket.tokensPerInterval-this.tokensThisInterval){if(this.fireImmediately)process.nextTick(e.bind(null,null,-1));else{var s=Math.ceil(this.curIntervalStart+this.tokenBucket.interval-i);setTimeout(function(){n.tokenBucket.removeTokens(t,o)},s)}return!1}return this.tokenBucket.removeTokens(t,o);function o(i,r){if(i)return e(i,null);n.tokensThisInterval+=t,e(null,r)}},tryRemoveTokens:function(t){if(t>this.tokenBucket.bucketSize)return!1;var e=r();if((e<this.curIntervalStart||e-this.curIntervalStart>=this.tokenBucket.interval)&&(this.curIntervalStart=e,this.tokensThisInterval=0),t>this.tokenBucket.tokensPerInterval-this.tokensThisInterval)return!1;var n=this.tokenBucket.tryRemoveTokens(t);return n&&(this.tokensThisInterval+=t),n},getTokensRemaining:function(){return this.tokenBucket.drip(),this.tokenBucket.content}},t.exports=s},3085:t=>{t.exports=function(){if("undefined"!=typeof process&&process.hrtime){var t=process.hrtime(),e=t[0],n=t[1];return 1e3*e+Math.floor(n/1e6)}return(new Date).getTime()}},5472:t=>{var e=function(t,e,n,i){if(this.bucketSize=t,this.tokensPerInterval=e,"string"==typeof n)switch(n){case"sec":case"second":this.interval=1e3;break;case"min":case"minute":this.interval=6e4;break;case"hr":case"hour":this.interval=36e5;break;case"day":this.interval=864e5;break;default:throw new Error("Invaid interval "+n)}else this.interval=n;this.parentBucket=i,this.content=0,this.lastDrip=+new Date};e.prototype={bucketSize:1,tokensPerInterval:1,interval:1e3,parentBucket:null,content:0,lastDrip:0,removeTokens:function(t,e){var n=this;return this.bucketSize?t>this.bucketSize?(process.nextTick(e.bind(null,"Requested tokens "+t+" exceeds bucket size "+this.bucketSize,null)),!1):(this.drip(),t>this.content?i():this.parentBucket?this.parentBucket.removeTokens(t,function(r,s){return r?e(r,null):t>n.content?i():(n.content-=t,void e(null,Math.min(s,n.content)))}):(this.content-=t,process.nextTick(e.bind(null,null,this.content)),!0)):(process.nextTick(e.bind(null,null,t,Number.POSITIVE_INFINITY)),!0);function i(){var i=Math.ceil((t-n.content)*(n.interval/n.tokensPerInterval));return setTimeout(function(){n.removeTokens(t,e)},i),!1}},tryRemoveTokens:function(t){return!(this.bucketSize&&(t>this.bucketSize||(this.drip(),t>this.content||this.parentBucket&&!this.parentBucket.tryRemoveTokens(t)||(this.content-=t,0))))},drip:function(){if(this.tokensPerInterval){var t=+new Date,e=Math.max(t-this.lastDrip,0);this.lastDrip=t;var n=e*(this.tokensPerInterval/this.interval);this.content=Math.min(this.content+n,this.bucketSize)}else this.content=this.bucketSize}},t.exports=e}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}var i,r={};(i=r).RateLimiter=n(3065),i.TokenBucket=n(5472),module.exports=r})();