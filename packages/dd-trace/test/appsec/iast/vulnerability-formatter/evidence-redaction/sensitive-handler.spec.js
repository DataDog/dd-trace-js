'use strict'

const sensitiveHandler =
  require('../../../../../src/appsec/iast/vulnerabilities-formatter/evidence-redaction/sensitive-handler')

const { suite } = require('../resources/evidence-redaction-suite.json')

function doTest (testCase, parameter) {
  const description = testCase.description.split(parameter.name).join(parameter.value)
  const input = JSON.parse(JSON.stringify(testCase.input).split(parameter.name).join(parameter.value))

  it(description, () => {
    input.forEach(source => {
      const result = sensitiveHandler.isSensibleSource(source)
      expect(result).to.be.true
    })
  })
}

describe('Sensitive handler', () => {
  describe('Sensible sources', () => {
    suite.filter(testCase => testCase.type === 'SOURCES').forEach((testCase) => {
      for (const name in testCase.parameters) {
        testCase.parameters[name].forEach(value => {
          doTest(testCase, { name, value })
        })
      }
    })
  })
})
